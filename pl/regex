(?is)((?:SELECT[\s]+[a-z0-9_]+[\s]*(?:\(.*?\))?.*?[\s]*(?:,(?:(?:[a-z0-9_\s]+)|(?:[\s]*.*?\(.*?\)[\s]*.*?)))*)(?:FROM .*?)(?:(?:WHERE(?:(?:[^()]*?)|(?:.*?\(.*?\)[\s]*)))))

(\{code:\n+\})?^SELECT \n*\r*\s*\w*\V+ (WHERE)*\w*\s*\V*(;*|(\{code\})*)$